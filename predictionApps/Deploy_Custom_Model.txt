MODEL_DIR="gs://ml_train_deploy_test/test87"
VERSION_NAME="V2"
MODEL_NAME="Test87_LogisticRegression"
CUSTOM_CODE_PATH="gs://ml_train_deploy_test/test_87/my_custom_predictor-0.1.tar.gz"
PREDICTOR_CLASS="predictor.MyPredictor"
REGION=us-central1

gcloud ai-platform models create $MODEL_NAME \
  --regions $REGION

# Install cloud beta components
gcloud components install beta

# Create version
gcloud beta ai-platform versions create $VERSION_NAME \
  --model $MODEL_NAME \
  --origin $MODEL_DIR \
  --runtime-version 1.13 \
  --python-version 3.5 \
  --package-uris $CUSTOM_CODE_PATH \
  --prediction-class $PREDICTOR_CLASS






gcloud beta ai-platform versions create V16 \
  --model Test87_LogisticRegression \
  --origin gs://ml_train_deploy_test/test87 \
  --runtime-version 1.14 \
  --python-version 3.5 \
  --package-uris gs://ml_train_deploy_test/test_87/my_custom_predictor-0.1.tar.gz \
  --prediction-class predictor.MyPredictor




# old functioning deployment
gcloud beta ai-platform versions create V17 \
  --model LogisticRegression \
  --origin gs://ml_train_deploy_test/sklearn_model_20190607_042456 \
  --runtime-version 1.14 \
  --python-version 3.5 \
  --package-uris gs://ml_train_deploy_test/my_custom_predictor-0.1.tar.gz \
  --prediction-class predictor.MyPredictor



#EXAMPLE --> WORKS!
gcloud ai-platform models create IrisPredictor \
  --regions us-central1

gcloud beta ai-platform versions create V1 \
  --model IrisPredictor \
  --runtime-version 1.13 \
  --python-version 3.5 \
  --origin gs://my_ml_test_bucket/example/ \
  --package-uris gs://my_ml_test_bucket/example/my_custom_code-0.1.tar.gz \
  --prediction-class predictor.MyPredictor

#EXAMPLE WITH PICKLE --> WORKS!
gcloud ai-platform models create IrisPredictorPickle \
  --regions us-central1

gcloud beta ai-platform versions create V1 \
  --model IrisPredictorPickle \
  --runtime-version 1.13 \
  --python-version 3.5 \
  --origin gs://my_ml_test_bucket/example_pickle/ \
  --package-uris gs://my_ml_test_bucket/example_pickle/my_custom_code-0.1.tar.gz \
  --prediction-class predictor.MyPredictor


#EXAMPLE WITH PICKLE AND TRY/CATCH IN LOADING FILES --> WORKS!
gcloud ai-platform models create IrisPredictorPickleTry \
  --regions us-central1

gcloud beta ai-platform versions create V1 \
  --model IrisPredictorPickleTry \
  --runtime-version 1.13 \
  --python-version 3.5 \
  --origin gs://my_ml_test_bucket/example_pickle_try/ \
  --package-uris gs://my_ml_test_bucket/example_pickle_try/my_custom_code-0.1.tar.gz \
  --prediction-class predictor.MyPredictor


# EXAMPLE WITH PICKLE AND TRY/CATCH NO PREPROCESS.PKL FILE IN PATH --> WORKS!
gcloud ai-platform models create IrisPredictorPickleTryNoFile \
  --regions us-central1

gcloud beta ai-platform versions create V1 \
  --model IrisPredictorPickleTryNoFile \
  --runtime-version 1.13 \
  --python-version 3.5 \
  --origin gs://my_ml_test_bucket/example_pickle_try_nofile/ \
  --package-uris gs://my_ml_test_bucket/example_pickle_try_nofile/my_custom_code-0.1.tar.gz \
  --prediction-class predictor.MyPredictor


# EXAMPLE WITH CONTAINER-TRAINED LOGISTIC REGRESSION --> WORKS! (probably it didn't work yesterday because of no credit on account)
gcloud ai-platform models create ContainerTrainedLogReg \
  --regions us-central1

gcloud beta ai-platform versions create V1 \
  --model ContainerTrainedLogReg \
  --runtime-version 1.13 \
  --python-version 3.5 \
  --origin gs://my_ml_test_bucket/container_test/j20190809051316_class_skl_logreg_basic/ \
  --package-uris gs://my_ml_test_bucket/container_test/my_custom_code-0.1.tar.gz \
  --prediction-class predictor.MyPredictor

# EXAMPLE TEST JSON PAYLOAD
{"instances": [[0.37251,0.3781,0.27941,0.74632,0.51044]], "probabilities": true}